(()=>{"use strict";!function(){class e{constructor(){this.config={customerForm:{formId:"#wf-form-Log-In-Customer",emailField:'[name="customer-email-input"]',passwordField:'[name="customer-password-input"]',submitButton:"#customer-login-btn"},retailerForm:{formId:"#wf-form-Log-In-Retailer",emailField:'[name="retailer-email-input"]',passwordField:'[name="retailer-password-input"]',submitButton:"#retailer-login-btn"}},this.authCore=null}init(){console.log("ðŸ” Niko Login Handler v1.0.0 initializing"),this.setupPasswordToggles(),this.waitForAuth().then(()=>{this.setupLoginForms()})}setupPasswordToggles(){document.querySelectorAll(".input-visibility-toggle").forEach(e=>{const o=e.querySelector('[wized="icon_show_password"]'),t=e.querySelector('[wized="icon_hide_password"]');t&&(t.style.display="none"),o&&(o.style.display="block"),e.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const i=e.previousElementSibling||e.parentElement.querySelector('input[type="password"], input[type="text"]');i&&("password"===i.type?(i.type="text",o&&(o.style.display="none"),t&&(t.style.display="block")):(i.type="password",o&&(o.style.display="block"),t&&(t.style.display="none")))})})}waitForAuth(){return new Promise(e=>{const o=setInterval(()=>{window.NikoAuthCore&&window.NikoAuthCore.isInitialized()&&(clearInterval(o),this.authCore=window.NikoAuthCore,console.log("âœ… NikoAuthCore is ready"),e())},100);setTimeout(()=>{clearInterval(o),console.error("âŒ NikoAuthCore initialization timeout"),e()},1e4)})}setupLoginForms(){const e=document.querySelector(this.config.customerForm.formId);if(e){console.log("ðŸ“ Customer login form found");const o=e.querySelector(".form_message-error-wrapper");o&&(o.style.display="none"),e.addEventListener("submit",async o=>{o.preventDefault(),o.stopImmediatePropagation();const t=e.querySelector(this.config.customerForm.emailField),r=e.querySelector(this.config.customerForm.passwordField),i=e.querySelector(this.config.customerForm.submitButton);t&&r&&await this.handleLogin(t.value,r.value,i,"Customer")})}const o=document.querySelector(this.config.retailerForm.formId);if(o){console.log("ðŸ“ Retailer login form found");const e=o.querySelector(".form_message-error-wrapper");e&&(e.style.display="none"),o.addEventListener("submit",async e=>{e.preventDefault(),e.stopImmediatePropagation();const t=o.querySelector(this.config.retailerForm.emailField),r=o.querySelector(this.config.retailerForm.passwordField),i=o.querySelector(this.config.retailerForm.submitButton);t&&r&&await this.handleLogin(t.value,r.value,i,"Retailer")})}}async handleLogin(e,o,t,r){if(!e||!o)return void this.showError("Please enter both email and password");console.log(`ðŸ”‘ Attempting ${r} login for:`,e);const i=t.value;t.value="Logging in...",t.disabled=!0;try{const n=await this.authCore.login(e,o);if(console.log("Login result:",n),n.success){let e=r;try{const o=await this.authCore.getCurrentUser();o&&o.user_metadata&&(e=o.user_metadata.user_type||o.user_metadata.role||r)}catch(e){console.warn("Could not get user metadata, using form type:",r)}const o="Customer"===e?"/dev/app/customer/dashboard":"/dev/app/retailer/dashboard";console.log("âœ… Login successful, redirecting to:",o),window.NikoNotificationManager&&window.NikoNotificationManager.show({type:"success",message:"Login successful! Redirecting..."}),setTimeout(()=>{window.location.href=o},500)}else{const e=this.getErrorMessage(n.error);console.error("Login failed:",n.error),this.showError(e),t.value=i,t.disabled=!1}}catch(e){console.error("Login error:",e),this.showError("An unexpected error occurred. Please try again."),t.value=i,t.disabled=!1}}getErrorMessage(e){return e?e.includes("Email not confirmed")?"Please confirm your email address before logging in.":e.includes("Invalid login credentials")||e.includes("User not found")?"Invalid email or password.":e.includes("Too many requests")?"Too many login attempts. Please try again later.":e.includes("Password")?"Incorrect password.":e.includes("Email")||e.includes("email")?"Email address not found.":e.includes("network")||e.includes("Network")?"Network error. Please check your connection.":e.length>100?"Login failed. Please try again.":e:"Login failed. Please try again."}showError(e){window.NikoNotificationManager?window.NikoNotificationManager.show({type:"error",message:e}):alert(e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){window.NikoLoginHandler=new e,window.NikoLoginHandler.init()}):(window.NikoLoginHandler=new e,window.NikoLoginHandler.init())}()})();