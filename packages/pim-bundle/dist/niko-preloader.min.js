(()=>{"use strict";!function(){class e{constructor(){this.preloaderElement=null,this.authChecked=!1,this.pageLoaded=!1,this.minimumShowTime=800,this.startTime=Date.now(),this.init()}init(){console.log("ðŸŽ¬ Preloader handler initializing"),this.preloaderElement=document.querySelector('[niko-data="page-loader"]'),this.preloaderElement?(this.showPreloader(),this.checkAuthAndPageReady()):console.warn('âš ï¸ Preloader element not found: [niko-data="page-loader"]')}showPreloader(){this.preloaderElement&&(this.preloaderElement.style.display="flex",this.preloaderElement.style.position="fixed",this.preloaderElement.style.top="0",this.preloaderElement.style.left="0",this.preloaderElement.style.width="100%",this.preloaderElement.style.height="100%",this.preloaderElement.style.backgroundColor="rgba(255, 255, 255, 0.95)",this.preloaderElement.style.zIndex="9999",this.preloaderElement.style.justifyContent="center",this.preloaderElement.style.alignItems="center",this.preloaderElement.style.opacity="1",this.preloaderElement.style.transition="opacity 0.3s ease-out",console.log("ðŸ‘ï¸ Preloader shown"))}hidePreloader(){if(!this.preloaderElement)return;const e=Date.now()-this.startTime,t=Math.max(0,this.minimumShowTime-e);setTimeout(()=>{this.preloaderElement&&(console.log("ðŸŽ¬ Hiding preloader"),this.preloaderElement.style.opacity="0",setTimeout(()=>{this.preloaderElement&&(this.preloaderElement.style.display="none",console.log("âœ… Preloader hidden"))},300))},t)}async checkAuthAndPageReady(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{this.pageLoaded=!0,this.checkIfReadyToHide()}):this.pageLoaded=!0,this.waitForAuthSystem().then(()=>{this.performAuthCheck()})}waitForAuthSystem(){return new Promise(e=>{const t=setInterval(()=>{window.NikoAuthCore&&window.NikoAuthCore.isInitialized()&&(clearInterval(t),console.log("ðŸ” Auth system ready"),e())},50);setTimeout(()=>{clearInterval(t),console.warn("âš ï¸ Auth system timeout - proceeding without auth check"),e()},5e3)})}async performAuthCheck(){try{if(this.isProtectedPage())if(console.log("ðŸ”’ Checking authentication for protected page"),window.NikoAuthCore){if(!await window.NikoAuthCore.getCurrentUser())return console.log("âŒ User not authenticated - redirecting to login"),void this.redirectToLogin();console.log("âœ… User authenticated"),this.authChecked=!0,this.checkIfReadyToHide()}else console.warn("âš ï¸ Auth system not available"),this.authChecked=!0,this.checkIfReadyToHide();else console.log("ðŸ“„ Public page - no auth check needed"),this.authChecked=!0,this.checkIfReadyToHide()}catch(e){console.error("âŒ Auth check error:",e),this.authChecked=!0,this.checkIfReadyToHide()}}isProtectedPage(){const e=window.location.pathname;return["/app/customer/","/app/retailer/","/dashboard","/profile","/onboarding"].some(t=>e.includes(t))}redirectToLogin(){const e="/app/auth/log-in";console.log("ðŸš€ Redirecting to login:",e),window.location.href=e}checkIfReadyToHide(){console.log("ðŸ” Checking if ready to hide:",{authChecked:this.authChecked,pageLoaded:this.pageLoaded}),this.authChecked&&this.pageLoaded&&this.hidePreloader()}forceHide(){console.log("ðŸš¨ Force hiding preloader"),this.hidePreloader()}updateText(e){if(this.preloaderElement){let t=this.preloaderElement.querySelector(".preloader-text");t||(t=document.createElement("div"),t.className="preloader-text",t.style.cssText="\n            position: absolute;\n            bottom: 2rem;\n            left: 50%;\n            transform: translateX(-50%);\n            color: #666;\n            font-size: 0.9rem;\n            text-align: center;\n          ",this.preloaderElement.appendChild(t)),t.textContent=e}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){window.NikoPreloader=new e,setTimeout(()=>{console.log("ðŸš¨ Emergency preloader timeout"),window.NikoPreloader&&window.NikoPreloader.forceHide()},1e4)}):(window.NikoPreloader=new e,setTimeout(()=>{console.log("ðŸš¨ Emergency preloader timeout"),window.NikoPreloader&&window.NikoPreloader.forceHide()},1e4))}()})();